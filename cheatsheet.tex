\documentclass[10pt,landscape]{article}
\usepackage[utf8]{inputenc}
\usepackage[french]{babel}
\usepackage{lmodern}
\usepackage{multicol}
\usepackage{calc}
\usepackage{ifthen}
\usepackage[landscape]{geometry}
\usepackage{amsmath,amsthm,amsfonts,amssymb}
\usepackage{color,graphicx,overpic}
\usepackage{hyperref}
\usepackage{listings}

\pdfinfo{
  /Title (Python3 CheatSheet)
  /Creator (TeX)
  /Producer (pdfTeX 1.40.0)
  /Author (Quentin Dufour)
  /Subject (python)
  /Keywords (python)}

% This sets page margins to .5 inch if using letter paper, and to 1cm
% if using A4 paper. (This probably isn't strictly necessary.)
% If using another size paper, use default 1cm margins.
\ifthenelse{\lengthtest { \paperwidth = 11in}}
    { \geometry{top=.5in,left=.5in,right=.5in,bottom=.5in} }
    {\ifthenelse{ \lengthtest{ \paperwidth = 297mm}}
        {\geometry{top=1cm,left=1cm,right=1cm,bottom=1cm} }
        {\geometry{top=1cm,left=1cm,right=1cm,bottom=1cm} }
    }

% Turn off header and footer
\pagestyle{empty}

% Redefine section commands to use less space
\makeatletter
\renewcommand{\section}{\@startsection{section}{1}{0mm}%
                                {-1ex plus -.5ex minus -.2ex}%
                                {0.5ex plus .2ex}%x
                                {\normalfont\large\bfseries}}
\renewcommand{\subsection}{\@startsection{subsection}{2}{0mm}%
                                {-1explus -.5ex minus -.2ex}%
                                {0.5ex plus .2ex}%
                                {\normalfont\normalsize\bfseries}}
\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{0mm}%
                                {-1ex plus -.5ex minus -.2ex}%
                                {1ex plus .2ex}%
                                {\normalfont\small\bfseries}}
\makeatother

% Define BibTeX command
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

% Don't print section numbers
\setcounter{secnumdepth}{0}


\setlength{\parindent}{0pt}
\setlength{\parskip}{0pt plus 0.5ex}

%My Environments
\newtheorem{example}[section]{Example}
% -----------------------------------------------------------------------

\begin{document}
\raggedright
\footnotesize
\begin{multicols}{3}


% multicol parameters
% These lengths are set only within the two main columns
%\setlength{\columnseprule}{0.25pt}
\setlength{\premulticols}{1pt}
\setlength{\postmulticols}{1pt}
\setlength{\multicolsep}{1pt}
\setlength{\columnsep}{2pt}

\begin{center}
     \Large{\underline{Python 3.x}} \\
\end{center}

\section{Structures}

Une classe

\begin{lstlisting}
class Dog(Animal):
  def __init__(self):
    # ...

  def hello(self):
    # ...
\end{lstlisting}

Une fonction

\begin{lstlisting}
def ma_fonction(arg1, arg2):
  return 3
\end{lstlisting}

Les conditions

\begin{lstlisting}
if a == b:
  # faire quelque chose
elif b == c:
  # autre chose
else:
  # encore autre chose
\end{lstlisting}

Les conditions ternaires

\begin{lstlisting}
a = 5 if c == b else 8
# Si c == b, a = 5 sinon 8
\end{lstlisting}

Gestion des exceptions

\begin{lstlisting}
try:
  # quelque chose
except:
  # autre chose
\end{lstlisting}

\section{Conversions}

Conversion entiers / chaines de caractères

\begin{lstlisting}
int("1853") * 2 # 3706
str(1853) * 2   # "18531853"
\end{lstlisting}

\section{Initialisations}

Initialiser une liste 6 éléments à 3
\begin{lstlisting}
l = [3,]*6
# [3, 3, 3, 3, 3, 3]
\end{lstlisting}

Initialiser 4 variables à None
\begin{lstlisting}
a,b,c,d = (None,)*4
# a=None, b=None, c=None, d=None
\end{lstlisting}

Générer une liste de carrés
\begin{lstlisting}
[i**2 for i in range(1,6)]
# Genere [1, 4, 9, 16, 25]
\end{lstlisting}

Générer un tableau 2D (une matrice) de 2 par 3 à -1

\begin{lstlisting}
[[-1 for x in range(2)] for y in range(3)]
# [[-1, -1],
#  [-1, -1],
#  [-1, -1]]
\end{lstlisting}

\section{Iterables}

Tout les exemples sont présentés avec une chaine de caractère mais fonctionnent également avec une liste ou d'autres iterables.

Itérer sur les charactères d'une liste
\begin{lstlisting}
for carac in "hello world":
  print(carac, end="-")
# h-e-l-l-o- -w-o-r-l-d-
\end{lstlisting}

Accéder à des caractères d'une liste
\begin{lstlisting}
"hello world"[2]  # 3eme element "l"
"hello world"[-1] # dernier element "d"
\end{lstlisting}

Accéder à des sous chaines de caractère
\begin{lstlisting}
chaine = "hello world"
chaine[1:5]   # "ello"
chaine[-5:-1] # "worl"
chaine[-5:]   # "world"
chaine[4:]    # "o world"
\end{lstlisting}

Inverse la chaîne de caractère
\begin{lstlisting}
chaine[::-1] # "dlrow olleh"
\end{lstlisting}

\section{Listes}

Ajout et concaténation
\begin{lstlisting}
[1, 2, 3].append(4)   # [1, 2, 3, 4]
[1, 2] + [3, 4]       # [1, 2, 3, 4]

a = [1, 2]
a += [3, 4]
a.extend([5, 6])
a.append(7)
# a = [1, 2, 3, 4, 5, 6, 7]
\end{lstlisting}

Associer plusieurs listes
\begin{lstlisting}
zip([1, 2, 3], [4, 5, 6])
# [(1, 4), (2, 5), (3, 6)]
\end{lstlisting}

Récupérer l'index d'un élément

\begin{lstlisting}
["foo", "bar", "baz"].index("bar")
# 1
\end{lstlisting}

\section{Chaines de caractères}

Conversion code ASCII / caractère
\begin{lstlisting}
chr(97)  # 'a'
ord('a') # 97
\end{lstlisting}

\section{Dictionnaire}

Vérifier l'existence d'une clé
\begin{lstlisting}
dic = {"a": 1}
if "a" in dic:
  # Verifie si la clef a existe
  pass
\end{lstlisting}

Itérer sur un dictionnaire
\begin{lstlisting}
dic = {"a": 1, "b": 2}
for cle, valeur in dic.items():
  print(cle, valeur)
\end{lstlisting}

\section{Tuple}

Tuple packing et unpacking
\begin{lstlisting}
t = 12345, 54321, 'hello!'
x, y, z = t
\end{lstlisting}

Cas particuliers (Tuple de 0 et 1 élément)
\begin{lstlisting}
empty = ()
singleton = 'hello',
# notez la derniere virgule
\end{lstlisting}

\section{Set}

Un set ne contient qu'une seule fois chaque valeur et n'est pas ordonné.
\begin{lstlisting}
{8, 9, 9, 1}
# {9, 8, 1}
\end{lstlisting}

\section{Entrées / Sorties}

Pour lire une ligne sur l'entrée standard :

\begin{lstlisting}
input() # stdin
\end{lstlisting}

Pour lire sur l'entrée standard jusqu'à un EOF (End Of File) :

\begin{lstlisting}
import sys

for line in sys.stdin:
  print(line)
\end{lstlisting}

\textit{Vous pourrez alors executer votre application avec "python3 monapp.py < fichier.txt" ou "python3 monapp.py" et écrire ce que vous voulez puis terminer par un CTRL + D}

Pour écrire sur la sortie standard :

\begin{lstlisting}
print(x, y, z) # print sur stdout
print("fatal error", file=sys.stderr)
# print sur stderr
\end{lstlisting}

\section{Fonctionnel}

Réduction (reduce)

\begin{lstlisting}
from functools import reduce
reduce(lambda x, y: x*y, [2, 3, 4])
# 2 * 3 * 4 = 24
\end{lstlisting}

Filtre (filter)
\begin{lstlisting}
list(filter(lambda x: x > 2, [1,2,3,4]))
# [3, 4]

[n for n in [1, 2, 3, 4] if n > 2]
# [3, 4]
\end{lstlisting}

Association (map)
\begin{lstlisting}
list(map(lambda x: x**2, [2, 3, 4]))
# [4, 9, 16]

[n**2 for n in [2, 3, 4]]
# [4, 9, 16]
\end{lstlisting}

\section{Mathématiques}

Récupérer le minimum ou le maximum de plusieurs valeurs.
\begin{lstlisting}
min(3, 5)       # 3
min(3, 2, 8, 7) # 2
min([13, 5, 8]) # 5
max(6, 3)       # 3
...
\end{lstlisting}

A la puissance n
\begin{lstlisting}
i, n = (3, 2)
i ** n    # 9
pow(i, n) # 9
\end{lstlisting}

Valeur absolue
\begin{lstlisting}
abs(-5) # 5
\end{lstlisting}

\section{Tri}

Retourner une nouvel iterable trié
(Fonctionne avec tout iterable)
\begin{lstlisting}
sorted([9,12,2])
# [2, 9, 12]

sorted({"F": 0, "D": 0, "A": 0, "B": 0})
# ['A', 'B', 'D', 'F']

sorted([9,12,2], reverse=True)
# [12, 9, 2]
\end{lstlisting}

Trier une liste (seulement)
\begin{lstlisting}
a = [5, 2, 8]
a.sort()
# a = [2, 5, 8]
\end{lstlisting}

%\section{Solveurs}

\section{Threads et Queue}

\begin{lstlisting}
from Queue import Queue
from threading import Thread

def listener(q):
  while True:
    print(q.get())

q = Queue()
t = Thread(target=listener, args=(q))

t.start()
q.put("hello")
\end{lstlisting}

\section{Réseau}

\begin{lstlisting}
import socket, select

sock = socket.socket( \
  socket.AF_INET, \
  socket.SOCK_STREAM)
rlist = []

sock.bind(('0.0.0.0', 1025))
sock.listen()

while True:
  rd, wr, err = select.select(rlist, [], [])
  for s in rd:
    if s is sock:
      client_socket, address = sock.accept()
      rlist.append(client_socket)
    else:
      data = s.recv(1024)
      if data: print(data); sock.send("OK")
      else: s.close(); rlist.remove(s)
\end{lstlisting}

\section{HTTP}
\url{http://flask.pocoo.org/docs/0.11/quickstart/}

Créer un dossier /static pour servir des fichiers.

Créer un dossier /templates pour mettre les templates au format JINJA2.

\begin{lstlisting}
<h1>{{ name }} </h1>
\end{lstlisting}

Code d'exemple avec Flask

\begin{lstlisting}
from flask import Flask, request, \
        render_template, url_for, session
app = Flask(__name__)

@app.route("/user")
@app.route("/user/<username>", \
        methods=['GET', 'POST'])
def hello(username=None):
    if request.method == 'POST':
        # request.form['hello']
        # session['username'] = xx
        return render_template( \
        'hello.html', name=username)
    else:
        return "Hello "+username+" !"

app.run()

\end{lstlisting}

\section{Stocker données}

TODO

\section{Hash et encodage}

base64

md5

hash

\section{Programmation dynamique}

Deux méthodes "systématiques":

1. Librairie standard
\begin{lstlisting}
from functools import lru_cache
...
#max_size le nombre d'éléments max du cache ou None (cache "infini")
@lru_cache(max_size=42)
def anything(*args):
    ....
\end{lstlisting}

2. homemade
\begin{lstlisting}
from collections import defaultdict
def dynamic(f):
    cache = defaultdict(lambda:-1)
    def is_known(*args):
        if cache[args] == -1:
            cache[args] = f(*args)
        return cache[args]
    return is_known
    
@dynamic
def anything(*args):
    ....
\end{lstlisting}


\section{Tableaux ASCII}

Lettres minuscules

\begin{tabular}{c|c||c|c||c|c}
\hline
dec & char & dec & char & dec & char\\
\hline
97  & a & 106 & j & 115 & s \\
98  & b & 107 & k & 116 & t \\
99  & c & 108 & l & 117 & u \\
100 & d & 109 & m & 118 & v \\
101 & e & 110 & n & 119 & w \\
102 & f & 111 & o & 120 & x \\
103 & g & 112 & p & 121 & y \\
104 & h & 113 & q & 122 & z \\
105 & i & 114 & r &     &   \\
\hline
\end{tabular}

Lettres majuscules

\begin{tabular}{c|c||c|c||c|c}
\hline
dec & char & dec & char & dec & char\\
\hline
65 & A & 74 & J & 83 & S \\
66 & B & 75 & K & 84 & T \\
67 & C & 76 & L & 85 & U \\
68 & D & 77 & M & 86 & V \\
69 & E & 78 & N & 87 & W \\
70 & F & 79 & O & 88 & X \\
71 & G & 80 & P & 89 & Y \\
72 & H & 81 & Q & 90 & Z \\
73 & I & 82 & R &     &   \\

\hline
\end{tabular}

\section{Algorithmes}

ROT N

Génération de nombres premiers

??

% You can even have references
\rule{0.3\linewidth}{0.25pt}
\scriptsize
\bibliographystyle{abstract}
\bibliography{refFile}
\end{multicols}
\end{document}
